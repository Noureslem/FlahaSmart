<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.geometry.Insets?>
<?import de.jensd.fx.glyphs.fontawesome.FontAwesomeIconView?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.shape.Rectangle?>

<BorderPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="controllers.Dashbord.ClientHomeController"
            stylesheets="@/css/client-home.css"
            style="-fx-background-color: #f8fafc;">

    <!-- Barre de navigation supérieure -->
    <top>
        <VBox spacing="0">
            <HBox alignment="CENTER_LEFT" spacing="30"
                  style="-fx-background-color: white; -fx-padding: 15 50; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.05), 10, 0, 0, 0);">

                <!-- Logo -->
                <HBox spacing="10" alignment="CENTER_LEFT" onMouseClicked="#handleAccueil" style="-fx-cursor: hand;">
                    <Rectangle width="32" height="32" style="-fx-fill: #27ae60; -fx-arc-width: 8; -fx-arc-height: 8;"/>
                    <Text text="FlahaSmart" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #1e293b;"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS"/>

                <!-- Menu de navigation -->
                <HBox spacing="25" alignment="CENTER">
                    <Button text="Accueil" styleClass="nav-link" onAction="#handleAccueil"/>
                    <Button text="Marketplace" styleClass="nav-link" onAction="#handleMarketplace"/>
                    <Button text="Forum" styleClass="nav-link" onAction="#handleForum"/>
                    <Button text="Actualités" styleClass="nav-link" onAction="#handleActualites"/>
                    <Button text="Contact" styleClass="nav-link" onAction="#handleContact"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS"/>

                <!-- Profil utilisateur cliquable -->
                <HBox spacing="20" alignment="CENTER">
                    <HBox spacing="15" alignment="CENTER" style="-fx-cursor: hand;" onMouseClicked="#handleNotifications">
                        <FontAwesomeIconView glyphName="BELL" size="20" fill="#64748b"/>
                        <Circle radius="4" fill="#ef4444" translateX="-22" translateY="-8"/>
                    </HBox>

                    <!-- Profil cliquable - ouvre DashboardUser -->
                    <HBox spacing="10" alignment="CENTER" style="-fx-cursor: hand;" onMouseClicked="#handleOpenDashboard">
                        <Circle radius="20" fill="#3498db"/>
                        <FontAwesomeIconView glyphName="USER" size="20" fill="white" translateX="-22"/>
                        <VBox spacing="2">
                            <Label fx:id="userNameLabel" text="Chargement..." style="-fx-font-weight: bold; -fx-text-fill: #1e293b;"/>
                            <Label fx:id="userEmailLabel" text="Client" style="-fx-font-size: 11px; -fx-text-fill: #64748b;"/>
                        </VBox>
                    </HBox>

                    <Button fx:id="logoutButton" onAction="#handleLogout"
                            style="-fx-background-color: transparent; -fx-padding: 5;">
                        <graphic>
                            <FontAwesomeIconView glyphName="SIGN_OUT" size="18" fill="#ef4444" style="-fx-cursor: hand;"/>
                        </graphic>
                    </Button>
                </HBox>
            </HBox>

            <!-- Barre de recherche -->
            <HBox style="-fx-background-color: #f1f5f9; -fx-padding: 15 50;" alignment="CENTER">
                <HBox spacing="10" style="-fx-background-color: white; -fx-background-radius: 30; -fx-padding: 5 5 5 20;" HBox.hgrow="ALWAYS">
                    <FontAwesomeIconView glyphName="SEARCH" size="16" fill="#94a3b8"/>
                    <TextField promptText="Rechercher des produits, discussions..."
                               style="-fx-background-color: transparent; -fx-border-color: transparent; -fx-pref-width: 400;"/>
                    <Button text="Rechercher" styleClass="search-button"/>
                </HBox>
            </HBox>
        </VBox>
    </top>

    <!-- Contenu principal avec scroll -->
    <center>
        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-border-color: transparent;">
            <VBox spacing="40" style="-fx-padding: 30 50;">

                <!-- Section Hero - CORRIGÉE avec classe CSS -->
                <VBox spacing="20" alignment="CENTER" styleClass="hero-section">
                    <Text fx:id="welcometext" text="Bienvenue sur FlahaSmart"
                          style="-fx-font-size: 48px; -fx-font-weight: bold; -fx-fill: white;"/>
                    <Text text="La plateforme intelligente pour l'agriculture moderne"
                          style="-fx-font-size: 20px; -fx-fill: rgba(255,255,255,0.9);"/>

                    <HBox spacing="20" alignment="CENTER" style="-fx-padding: 20;">
                        <Button text="Explorer le Marketplace" styleClass="hero-button-primary" onAction="#handleMarketplace"/>
                        <Button text="Rejoindre le Forum" styleClass="hero-button-secondary" onAction="#handleForum"/>
                    </HBox>
                </VBox>

                <!-- Section Fonctionnalités principales -->
                <VBox spacing="20">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontAwesomeIconView glyphName="STAR" size="24" fill="#f59e0b"/>
                        <Text text="Fonctionnalités principales" style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-fill: #1e293b;"/>
                    </HBox>

                    <HBox spacing="20" alignment="CENTER">

                        <!-- Carte Marketplace -->
                        <VBox styleClass="feature-card" prefWidth="300" prefHeight="280" onMouseClicked="#handleMarketplace">
                            <StackPane styleClass="feature-icon-large">
                                <FontAwesomeIconView glyphName="SHOPPING_CART" size="50" fill="#27ae60"/>
                            </StackPane>
                            <Text text="Marketplace" styleClass="feature-title-large"/>
                            <Text text="Achetez et vendez des produits agricoles" styleClass="feature-desc" wrappingWidth="250"/>
                            <HBox spacing="5" alignment="CENTER" styleClass="feature-stats">
                                <FontAwesomeIconView glyphName="TAG" size="12" fill="#f59e0b"/>
                                <Text text="150+ produits" style="-fx-fill: #64748b;"/>
                                <FontAwesomeIconView glyphName="USER" size="12" fill="#3498db" translateX="10"/>
                                <Text text="45 vendeurs" style="-fx-fill: #64748b;" translateX="10"/>
                            </HBox>
                        </VBox>

                        <!-- Carte Forum -->
                        <VBox styleClass="feature-card" prefWidth="300" prefHeight="280" onMouseClicked="#handleForum">
                            <StackPane styleClass="feature-icon-large">
                                <FontAwesomeIconView glyphName="COMMENTS" size="50" fill="#3498db"/>
                            </StackPane>
                            <Text text="Forum" styleClass="feature-title-large"/>
                            <Text text="Échangez avec la communauté" styleClass="feature-desc" wrappingWidth="250"/>
                            <HBox spacing="5" alignment="CENTER" styleClass="feature-stats">
                                <FontAwesomeIconView glyphName="COMMENT" size="12" fill="#f59e0b"/>
                                <Text text="230 discussions" style="-fx-fill: #64748b;"/>
                                <FontAwesomeIconView glyphName="USERS" size="12" fill="#3498db" translateX="10"/>
                                <Text text="120 membres" style="-fx-fill: #64748b;" translateX="10"/>
                            </HBox>
                        </VBox>

                        <!-- Carte Actualités -->
                        <VBox styleClass="feature-card" prefWidth="300" prefHeight="280" onMouseClicked="#handleActualites">
                            <StackPane styleClass="feature-icon-large">
                                <FontAwesomeIconView glyphName="NEWSPAPER" size="50" fill="#e67e22"/>
                            </StackPane>
                            <Text text="Actualités" styleClass="feature-title-large"/>
                            <Text text="Restez informé des dernières nouvelles" styleClass="feature-desc" wrappingWidth="250"/>
                            <HBox spacing="5" alignment="CENTER" styleClass="feature-stats">
                                <FontAwesomeIconView glyphName="CALENDAR" size="12" fill="#f59e0b"/>
                                <Text text="15 articles" style="-fx-fill: #64748b;"/>
                            </HBox>
                        </VBox>
                    </HBox>
                </VBox>

                <!-- Section Marketplace en vedette -->
                <VBox spacing="20">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontAwesomeIconView glyphName="FIRE" size="24" fill="#ef4444"/>
                        <Text text="Produits en vedette" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #1e293b;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="Voir tout →" styleClass="view-all-link" onAction="#handleMarketplace"/>
                    </HBox>

                    <HBox spacing="20" alignment="CENTER">

                        <!-- Produit 1 -->
                        <VBox styleClass="product-card" prefWidth="220">
                            <StackPane style="-fx-background-color: #e8f5e9; -fx-background-radius: 15 15 0 0; -fx-padding: 30;">
                                <FontAwesomeIconView glyphName="APPLE" size="60" fill="#27ae60"/>
                            </StackPane>
                            <VBox spacing="10" style="-fx-padding: 15;">
                                <Text text="Pommes Bio" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                <Text text="Pommes fraîches de saison" style="-fx-fill: #64748b; -fx-font-size: 13px;" wrappingWidth="180"/>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="4.5" style="-fx-font-weight: bold;"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#cbd5e1"/>
                                    <Text text="(23)" style="-fx-fill: #94a3b8;" translateX="5"/>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="12.50 DT" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-fill: #27ae60;"/>
                                    <Text text="/kg" style="-fx-fill: #94a3b8;"/>
                                </HBox>
                                <Button text="Ajouter au panier" styleClass="add-to-cart-btn" maxWidth="Infinity"/>
                            </VBox>
                        </VBox>

                        <!-- Produit 2 -->
                        <VBox styleClass="product-card" prefWidth="220">
                            <StackPane style="-fx-background-color: #fff3e0; -fx-background-radius: 15 15 0 0; -fx-padding: 30;">
                                <FontAwesomeIconView glyphName="LEAF" size="60" fill="#e67e22"/>
                            </StackPane>
                            <VBox spacing="10" style="-fx-padding: 15;">
                                <Text text="Légumes Bio" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                <Text text="Panier de légumes frais" style="-fx-fill: #64748b; -fx-font-size: 13px;" wrappingWidth="180"/>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="5.0" style="-fx-font-weight: bold;"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <Text text="(45)" style="-fx-fill: #94a3b8;" translateX="5"/>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="25.00 DT" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-fill: #27ae60;"/>
                                </HBox>
                                <Button text="Ajouter au panier" styleClass="add-to-cart-btn" maxWidth="Infinity"/>
                            </VBox>
                        </VBox>

                        <!-- Produit 3 -->
                        <VBox styleClass="product-card" prefWidth="220">
                            <StackPane style="-fx-background-color: #fee2e2; -fx-background-radius: 15 15 0 0; -fx-padding: 30;">
                                <FontAwesomeIconView glyphName="HEART" size="60" fill="#ef4444"/>
                            </StackPane>
                            <VBox spacing="10" style="-fx-padding: 15;">
                                <Text text="Fraises" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                <Text text="Fraises juteuses et sucrées" style="-fx-fill: #64748b; -fx-font-size: 13px;" wrappingWidth="180"/>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="4.8" style="-fx-font-weight: bold;"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <Text text="(32)" style="-fx-fill: #94a3b8;" translateX="5"/>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="18.00 DT" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-fill: #27ae60;"/>
                                    <Text text="/barquette" style="-fx-fill: #94a3b8;"/>
                                </HBox>
                                <Button text="Ajouter au panier" styleClass="add-to-cart-btn" maxWidth="Infinity"/>
                            </VBox>
                        </VBox>

                        <!-- Produit 4 -->
                        <VBox styleClass="product-card" prefWidth="220">
                            <StackPane style="-fx-background-color: #e0f2fe; -fx-background-radius: 15 15 0 0; -fx-padding: 30;">
                                <FontAwesomeIconView glyphName="TINT" size="60" fill="#3498db"/>
                            </StackPane>
                            <VBox spacing="10" style="-fx-padding: 15;">
                                <Text text="Miel Pur" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                <Text text="Miel naturel de montagne" style="-fx-fill: #64748b; -fx-font-size: 13px;" wrappingWidth="180"/>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="5.0" style="-fx-font-weight: bold;"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <FontAwesomeIconView glyphName="STAR" size="12" fill="#f59e0b"/>
                                    <Text text="(18)" style="-fx-fill: #94a3b8;" translateX="5"/>
                                </HBox>
                                <HBox alignment="CENTER_LEFT" spacing="5">
                                    <Text text="35.00 DT" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-fill: #27ae60;"/>
                                    <Text text="/pot" style="-fx-fill: #94a3b8;"/>
                                </HBox>
                                <Button text="Ajouter au panier" styleClass="add-to-cart-btn" maxWidth="Infinity"/>
                            </VBox>
                        </VBox>
                    </HBox>
                </VBox>

                <!-- Section Forum récent -->
                <VBox spacing="20">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontAwesomeIconView glyphName="COMMENTS" size="24" fill="#3498db"/>
                        <Text text="Discussions récentes" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #1e293b;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="Voir tout →" styleClass="view-all-link" onAction="#handleForum"/>
                    </HBox>

                    <VBox spacing="10">

                        <!-- Discussion 1 -->
                        <HBox spacing="15" styleClass="forum-thread" alignment="CENTER_LEFT" onMouseClicked="#handleForum">
                            <StackPane styleClass="forum-icon">
                                <FontAwesomeIconView glyphName="QUESTION" size="16" fill="#3498db"/>
                            </StackPane>
                            <VBox spacing="3">
                                <Text text="Comment cultiver des tomates bio ?" style="-fx-font-weight: bold; -fx-font-size: 15px;"/>
                                <HBox spacing="15">
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="USER" size="10" fill="#94a3b8"/>
                                        <Text text="Jean_M" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="COMMENT" size="10" fill="#94a3b8"/>
                                        <Text text="8 réponses" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="CLOCK" size="10" fill="#94a3b8"/>
                                        <Text text="Il y a 2 heures" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                </HBox>
                            </VBox>
                        </HBox>

                        <!-- Discussion 2 -->
                        <HBox spacing="15" styleClass="forum-thread" alignment="CENTER_LEFT" onMouseClicked="#handleForum">
                            <StackPane styleClass="forum-icon">
                                <FontAwesomeIconView glyphName="QUESTION" size="16" fill="#3498db"/>
                            </StackPane>
                            <VBox spacing="3">
                                <Text text="Meilleur engrais naturel ?" style="-fx-font-weight: bold; -fx-font-size: 15px;"/>
                                <HBox spacing="15">
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="USER" size="10" fill="#94a3b8"/>
                                        <Text text="Marie_Agri" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="COMMENT" size="10" fill="#94a3b8"/>
                                        <Text text="12 réponses" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="CLOCK" size="10" fill="#94a3b8"/>
                                        <Text text="Hier" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                </HBox>
                            </VBox>
                        </HBox>

                        <!-- Discussion 3 -->
                        <HBox spacing="15" styleClass="forum-thread" alignment="CENTER_LEFT" onMouseClicked="#handleForum">
                            <StackPane styleClass="forum-icon">
                                <FontAwesomeIconView glyphName="QUESTION" size="16" fill="#3498db"/>
                            </StackPane>
                            <VBox spacing="3">
                                <Text text="Prix des olives cette année ?" style="-fx-font-weight: bold; -fx-font-size: 15px;"/>
                                <HBox spacing="15">
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="USER" size="10" fill="#94a3b8"/>
                                        <Text text="OlivePro" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="COMMENT" size="10" fill="#94a3b8"/>
                                        <Text text="5 réponses" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                    <HBox spacing="5">
                                        <FontAwesomeIconView glyphName="CLOCK" size="10" fill="#94a3b8"/>
                                        <Text text="3 jours" style="-fx-fill: #64748b; -fx-font-size: 12px;"/>
                                    </HBox>
                                </HBox>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>
            </VBox>
        </ScrollPane>
    </center>
</BorderPane>